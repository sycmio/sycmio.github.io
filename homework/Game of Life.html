<!DOCTYPE HTML>
<html>
<head>
<title>Game of Life</title>
<meta charset=UTF-8>
<style type="text/css">
	#title{
		position: absolute;
		top:80px;
		left: 200px;
		font-family:STxihei;
		font-size:40px;

	}
	.s{
		position: absolute;
		height:30px;
		font-family:STxihei;
		font-size:15px;
		background:white;
		border:1px solid black;
		text-align: center;
	}
	.text{
		position: absolute;
		height:30px;
		font-family:STxihei;
		font-size:15px;
		line-height: 30px;
	}
</style>
</head>
<body>

<canvas id="myCanvas" style="position:absolute;top:200px;left:400px;">your browser does not support the canvas tag </canvas>

<script type="text/javascript">

//canvas对象
var canvas = document.getElementById('myCanvas');
var ctx    = canvas.getContext('2d');
//默认初始活细胞比例
var percentage_livingcells = 20;

//生成细胞格子
var cell_cellnum_inOneColume=100;
var cell_cellnum_inOneRow=100;
var cell = new Array();
var temp_cell = new Array();

//绘制
var paint_cell = function(){
	for (var i = 0; i < cell_cellnum_inOneColume; i++) {
		for (var j = 0; j < cell_cellnum_inOneRow; j++) {
			//细胞为生
			if (cell[i][j] == 1) {
				ctx.beginPath();
				ctx.arc(j * 5 + 2.5, i * 5 + 2.5, 2.5, 0, 360, false);
				//填充颜色
				ctx.fillStyle="#009700";
				//画实心圆
				ctx.fill();
				ctx.closePath();
			}
			//细胞为死
			else {
				cell[i][j] = 0;
				ctx.fillStyle='#FFFFFF';
				ctx.fillRect(j * 5, i * 5, (j + 1) * 5, (i + 1) * 5);
			};
		}
	}
}

//随机生成初始细胞生死状态
var random_fate = function(){
	for (var i = 0; i < cell_cellnum_inOneColume; i++) {
		cell[i] = new Array();
	};
	for (var i = 0; i < cell_cellnum_inOneColume; i++) {
		temp_cell[i] = new Array();
	};
	for (var i = 0; i < cell_cellnum_inOneColume; i++) {
		for (var j = 0; j < cell_cellnum_inOneRow; j++) {
			//初始细胞状态
			cell[i][j] = parseInt((100/percentage_livingcells) * Math.random());
			if(cell[i][j] == 0){
				cell[i][j] = 1;
			}
			else{
				cell[i][j] = 0;
			}
		}
	}
	paint_cell();
}

//计算周围活细胞个数
var count_aroundlivingcells = function (i, j) { 
	var num_aroundlivingcells = 0;
	if (i == 0 || j == 0 || i == cell_cellnum_inOneColume - 1 || j == cell_cellnum_inOneRow - 1) {
		//左上角
		if      (i == 0 && j == 0) 					              { num_aroundlivingcells = cell[i][j + 1] + cell[i + 1][j + 1] + cell[i + 1][j]}
		//右上角
		else if (i == 0 && j == cell_cellnum_inOneRow - 1)               { num_aroundlivingcells = cell[i][j - 1] + cell[i + 1][j - 1] + cell[i + 1][j]}
		//左下角
		else if (i == cell_cellnum_inOneColume - 1 && j == 0)                  { num_aroundlivingcells = cell[i - 1][j] + cell[i - 1][j + 1] + cell[i][j + 1]}
		//右下角
		else if (i == cell_cellnum_inOneColume - 1 && j == cell_cellnum_inOneRow - 1) { num_aroundlivingcells = cell[i - 1][j] + cell[i - 1][j - 1] + cell[i][j - 1]}
		//上边界
		else if (i == 0)                                          { num_aroundlivingcells = cell[i][j - 1] + cell[i][j + 1] + cell[i + 1][j - 1] + cell[i + 1][j] + cell[i + 1][j + 1]}
		//左边界
		else if (j == 0)                                          { num_aroundlivingcells = cell[i - 1][j] + cell[i - 1][j + 1] + cell[i][j + 1] + cell[i + 1][j + 1] + cell[i + 1][j]}
		//下边界
		else if (i == cell_cellnum_inOneColume - 1)                            { num_aroundlivingcells = cell[i][j - 1] + cell[i - 1][j - 1] + cell[i - 1][j] + cell[i - 1][j + 1] + cell[i][j + 1]}
		//右边界
		else if (j == cell_cellnum_inOneRow - 1)                         { num_aroundlivingcells = cell[i - 1][j] + cell[i - 1][j - 1] + cell[i][j - 1] + cell[i + 1][j - 1] + cell[i + 1][j]};
	}
	else {
		num_aroundlivingcells = cell[i - 1][j - 1] + cell[i][j - 1] + cell[i + 1][j - 1] + cell[i - 1][j] + cell[i + 1][j] + cell[i - 1][j + 1] + cell[i][j + 1] + cell[i + 1][j + 1];
	}
	return num_aroundlivingcells;
}

//更新细胞状态并显示
var refresh_fate = function () {
	var num_aroundlivingcells = 0;
	for (var i = 0; i < cell_cellnum_inOneColume; i++) {
		for (var j = 0; j < cell_cellnum_inOneRow; j++) {
			num_aroundlivingcells = count_aroundlivingcells(i, j);
			if (num_aroundlivingcells == 3) {
				temp_cell[i][j] = 1;
			}
			else if (num_aroundlivingcells == 2) {
				temp_cell[i][j] = cell[i][j];
			}
			else {
				temp_cell[i][j] = 0;
			};
			
		}
	}
	//更改细胞状态
	for (var i = 0; i < cell_cellnum_inOneColume; i++) {
		for (var j = 0; j < cell_cellnum_inOneRow; j++) {
			cell[i][j] = temp_cell[i][j];
		}
	}
	//刷新显示
	paint_cell();
}

//改变更迭时间间隔
var flag_hasInitialed = 0;
var flag_firstclick = 0;
var fun_interval;
var start_or_change_interval = function () {
	if(flag_hasInitialed == 1){
		//不是首次更改
		if (flag_firstclick == 1) {
			//清除已存在时间重复函数
			clearInterval(fun_interval);
		};
		//输入的是合法数字
		if (!isNaN(document.getElementById("interval").value) && document.getElementById("interval").value.length != 0) {
			var interval = document.getElementById("interval").value;
			fun_interval = setInterval(refresh_fate, interval);
		}
		//其他非法输入或空输入
		else {
			fun_interval = setInterval(refresh_fate, 200);
		}
		flag_firstclick = 1;
	}

}

//暂停更迭
var pause_interval = function () {
	if (flag_firstclick == 1) {
		clearInterval(fun_interval);
		flag_firstclick = 0;
	}

};

//初始化
var initial = function () {
	flag_hasInitialed = 1;
	//不是首次更改	
	if (flag_firstclick == 1) {
		//清除已存在时间重复函数
		clearInterval(fun_interval);
		flag_firstclick = 0;
	};
	//判断是否更改活细胞百分比
	if (!isNaN(document.getElementById("percentage_livingcells").value) && document.getElementById("percentage_livingcells").value.length != 0) {
		percentage_livingcells = parseInt(document.getElementById("percentage_livingcells").value);
		if(percentage_livingcells <= 0 || percentage_livingcells > 100){
			percentage_livingcells = 20;
		}
	}
	else {
		percentage_livingcells = 20;
	};
    //判断是否更改行数
	if (!isNaN(document.getElementById("cellnum_inOneColume").value) && document.getElementById("cellnum_inOneColume").value.length != 0) {
		cell_cellnum_inOneColume = parseInt(document.getElementById("cellnum_inOneColume").value);
	}
	else {
		cell_cellnum_inOneColume = 100;
	};
	//判断是否更改列数
	if (!isNaN(document.getElementById("cellnum_inOneRow").value) && document.getElementById("cellnum_inOneRow").value.length != 0) {
		cell_cellnum_inOneRow = parseInt(document.getElementById("cellnum_inOneRow").value);
	}
	else {
		cell_cellnum_inOneRow = 100;
	};

	//初始化
	canvas.setAttribute("width", cell_cellnum_inOneRow * 5);
	canvas.setAttribute("height", cell_cellnum_inOneColume * 5);
	random_fate();
}


</script>

<div id="title">
	Game of Life
</div>

<div style="position:absolute;left:100px;top:225px;width:300px;height:300px;">
	<div class ="text" style="left:0px;top:0px;">更迭速度：</div>
	<input id  ="interval" class="s" type="text" name="interval" value="200" style="width:50px;left:120px;top:0px;">
	<div class ="text" style="left:200px;top:0px;">毫秒/次</div>
	
	<div class ="text" style="left:0px;top:50px;">行细胞数：</div>
	<input id  ="cellnum_inOneRow" class="s" type="text" name="cellnum_inOneRow" value="100" style="width:50px;left:120px;top:50px;">
	<div class ="text" style="left:200px;top:50px;">个/行</div>
	<div class ="text" style="left:0px;top:100px;">列细胞数：</div>
	<input id  ="cellnum_inOneColume" class="s" type="text" name="cellnum_inOneColume" value="100" style="width:50px;left:120px;top:100px;">
	<div class ="text" style="left:200px;top:100px;">个/列</div>

	<div class ="text" style="left:0px;top:150px;">活细胞初始比例：</div>
	<input id="percentage_livingcells" class="s" type="text" name="percentage_livingcells" value="20" style="width:50px;left:120px;top:150px;">
	<div class ="text" style="left:200px;top:150px;">%</div>

	<button id = "submit_initial" class="s" onclick="initial()"  style="width:150px;left:0px;top:250px;" >初始化/重新开始
	<button id = "submit_interval" class="s" onclick="start_or_change_interval()" value="200" style="width:150px;left:0px;top:300px;" >开始/更改速度
	<button id="pause" class="s" onclick="pause_interval()" style="width:150px;left:0px;top:350px;">暂停</button>
	<button id="refresh" class="s" onclick="refresh_fate()" style="width:150px;left:0px;top:400px;">单次更替</button>

</div>


</body>
</html>